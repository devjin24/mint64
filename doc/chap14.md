# 14장 키보드 디바이스 드라이버를 업그레이드하자

## 14.1 인터럽트 핸들러와 큐

### 14.1.1 인터럽트 핸들러와 어떻게 통신할까?
### 14.1.2 큐란 무엇인가?
### 14.1.3 범용 큐 설계
### 14.1.4 범용 큐 구현과 사용방법

## 14.2 키보드 디바이스 드라이버 업그레이드

### 14.2.1 키 정보를 저장하는 자료구조와 큐 생성
### 14.2.2 인터럽트로 이한 문제와 인터럽트 제어
인터럽트 기반으로 업그레이드한 키보드 디바이스 드라이버 코드에는 두 가지 문제가 있다.
1. 큐에 삽입이나 제거를 수행할 때 인터럽트가 발생해서 인덱스에 문제가 생길 수 있다.  
2. 키보드 활성화나 LED 컨트롤 같은 제어 명령의 ACK를 인터럽트가 가로챌 수 있는 문제이다. 이전 코드는 키브드로 제어 명령을 전송하고 나서 ACK가 수신될 때까지 일정 시간을 기다려 성공 여부를 판단하도록 구현했기 때문이다.

두 가지 문제의 공통된 원인은 인터럽트가 발생하지 않아야 하는 구간에서 인터럽트가 발생했기 때문이다. 이를 해결하기 위해 이전의 인터럽트 상태를 저장했다가 복원하는 방법이 있다.

### 14.3 키보드 디바이스 드라이버 업그레이드와 빌드
02.Kernel64/Source/Queue.c
02.Kernel64/Source/Queue.h
02.Kernel64/Source/Keyboard.c
02.Kernel64/Source/Keyboard.h
02.Kernel64/Source/InterruptHandler.c
02.Kernel64/Source/Utility.c
02.Kernel64/Source/Utility.h
02.Kernel64/Source/Main.c
