# 12 GDT, IDT 테이블, TSS 세그먼트를 추가해 인터럽트에 대비하자
## 12.1 인터럽트와 예외
### 12.1.1 인터럽트와 예외의 차이점
인터럽트와 예외의 공통점은 코드 수행 도중에 발생하거나 프로세서에 의해 처리가 필요한 일종의 이벤트라는 점이다. 
인터럽트나 예외가 발생하면 프로세서는 이를 처리하려고 준비한 특수한 코드를 실행하며, 실행이 끝난 뒤에는 수행 중이던 코드로 복귀한다.  

인터럽트와 예외의 차이점은 이벤트를 발생시키는 주체이 있다. 
* 인터럽트 - 키보드나 마우스, 하드 디스크 같은 외부 디바이스에 의해 발생하여 프로세서에 전달되는 이벤트
* 예외 - 프로세서가 코드를 수행하는 도중에 페이지 폴트나 잘못된 명령 같은 오류를 발견했을 때 발생(프로세서 자신)

### 12.1.2 IDT와 IDT 게이트 디스크립터
프로세서는 인터럽트가 발생했을 때 벡터 테이블의 인덱스에 해당하는 어드레스로 이동하여 처리 함수를 수행한다.  
인터럽트 게이트와 트랩게이트의 차이는 핸드러를 수행하느 동안 다른 인터럽트가 발생할 수 있는가이다.

### 12.1.3 인터럽트와 예외의 종류
* x86 프로세서는 IDT 테이블의 상위 32개 디스크립터를 예약해서 예외처리에 사용한다.
* 예외처리에 할당한 0~31 번을 제외한 나머지 224개는 OS가 임의로 사용할 수 있다.
* 프로세서가 사용하는 예외는 다시 Faults, Traps, Aborts 세 가지로 분류할 수 있다.
* Faults는 문제가 발생했으나 해당 코드의 문제를 수정하면 정상적으로 실행 가능한 예외를 의미한다.
* Traps는 Trap을 유발하는 명령어을 실행했을 때 발생한다.
* Aborts는 심각한 문제가 발생하여 문제가 발생한 정확한 어드레스를 찾을 수 없다.

### 12.1.4 PC 인터럽트의 종류와 발생 원인
* PIC (programmable Interrupt Controller) 컨트롤러를 사용해서 외부 인터럽트를 관리했다.  
* PIC 컨트롤러의 경우 프로세서로 전달하는 인터럽트 번호를 임의로 설정할 수 있다.

## 12.2 인터럽트와 예외, 스택과 태스크 상태 세그먼트
* 스택 스위칭은 인터럽트나 예외가 발생했을 때 태스크를 수행중이던 스택에서 인터럽트 또는 예외처리용 스택으로 전환하는 것을 의미한다.

### 12.2.1 스택 스위칭과 IST(interrupt stack table)
* 스택 스위칭을 하는 이유는 크게 두 가지이다.
* 높은 권한의 코드(핸들러)가 스택 공간의 부족으로 오류가 발생하는 일을 미리 방지한다.
* 권한이 높은 함수가 낮은 권한의 스택을 공유함으로써 발생할 수 있는 간섭을 최소화한다.
* IA-32e 모드에서 인터럽트 스택 테이블(IST)이라는 새로운 기법을 도입했다.
* IST는 인터럽트 처리를 위한 스택을 정의한 테이블로 최대 7개의 스택을 지정할 수 있다.

### 12.2.2 프로세서와 태스크 상태 세그먼트, 태스크 디스크립터
* 태스크 상태 세그먼트(TSS)는 태스크의 상태를 저장하는 영역으로 프로세서의 상태, 즉 레지스터의 값을 저장하는 역할을 했다.
* 64비트 모드에서는 7개의 IST 정보를 저장하는 역할을 TSS에 부여했다.

## 12.3 GDT 테이블 교환과 TSS 세그먼트 디스크립터 추가
### 12.3.1 왜 GDT 테이블을 교환해야 하는가?
* 멀티코어를 활성화하게 되면 코어 별로 TSS 세그먼트가 필요하다.

### 12.3.2 GDT 테이블 생성과 TSS 세그먼트 디스크립터 추가

