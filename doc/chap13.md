# 13장 PIC 컨트롤러와 인터럽트 핸들러를 이용해 인터럽트를 처리하자

---

## 13.1 PIC 컨트롤러 소개

### 13.1.1 PIC 컨트롤러란
PIC 컨트롤러는 Programmable Interrupt Controller의 약자로 인터럽트 처리에 관련된 기능을 프로그래밍 할 수 있는 컨트롤러다.

PIC 컨트롤러 2개를 마스터-슬레이브 방식으로 연결하여 최대 15개의 인터럽트를 처리할 수 있다. 마스터의 2번 핀을 슬래이브와 연결하는데 사용하기 때문에 15개만 처리 가능하다.

마스터와 슬레이브 순으로 부여한 이터럽트 핀 번호를 IRQ (Interrupt Request) 번호라고 부르며, 각각의 핀은 PC 디바이스의 인터럽트 핀과 연결되 어 있다.

### 13.1.2 PIC 컨트롤러의 구조와 동작 방식

![](asset/cpu_pic8259.PNG)

PIC 컨트롤러는 내부에 8비트 크기의 IRR, ISR, IMR 레지스터가 있다. 레지스터의 역할은 다음과 같다.

* IRR(Interrupt Request Register) 는 외부 디바이스와 연결된 인터럽트 핀 중에서 인터럽트가 발생한 핀의 정보를 관리한다. 외부 디바이스가 인터럽트를 발생시키면 PIC 컨트롤러는 IRR에 해당 비트를 1로 설정하여 인터럽트 발생 여부를 저장한다.
* ISR(In-Service Register) 는 현재 인터럽트 핸들러가 실행 중인 인터럽트의 정보를 나타낸다. PIC 컨트롤러는 특별한 옵션을 사용하지 않는 한 IRQ 0에 가까울수록 우선순위를 높게 설정하므로 ISR에 설정된 비트는 IRR에 설정된 비트 중에서 0에 가까운 비트와 같다.
* IMR(Interrupt Mask Register)는 비트가 1로 설정된 인터럽트 핀에서 발생한 인터럽트 요청을 무시하는 역할을 한다.

PIC 컨트롤러의 INT 핀과 프로세서의 INTR이 연결되어 있고, 인터럽트가 발생했을 때 INT 핀에 신호를 발생시켜 프로세서가 인터럽트를 처리하게 한다.
PIC의 /INTA 핀은 인터럽트가 프로세서에 잘 전달되었음을 프로세서가 알려주는 핀이다.

처리하는 과정은 아래와 같다.

1. PIC에 인터럽트 요청이 수신되고, PIC은 IRR의 해당 비트를 1로 설정
2. PIC은 INT 핀으로 신호를 보내 프로세서에 인터럽트가 발생했음을 알림
3. 프로세서는 /INTA 핀으로 인터럽트 요청이 정상적으로 수신되었음을 PIC에 알림
4. PIC은 IRR에서 가장 우선순위가 높은 것을 찾아 삭제한 뒤 ISR의 해당피트에 1로 설정 후 인터럽트 벡터의 번호를 프로세서에 전송
5. 프로세서는 인터럽트 처리 완료 후 EOI 커맨드를 PIC에 전송하고, PIC 컨트롤러는 ISR에 설정된 비트를 삭제
6. 인터럽트 완료 후 IRR 레지스터를 확인하여 처리되지 않은 인터럽트 요청이 있다면 2~5 과정을 반복

## 13.2 PIC 컨트롤러 제어

### 13.2.1 PIC 컨트롤러 초기화

