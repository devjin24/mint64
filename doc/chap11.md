# 11 키보드 디바이스 드라이버를 추가하자
## 11.1 키보드 컨트롤러의 구조와 기능
키보드 컨트롤러는 PC 내부 버스와 포트 I/O 방식으로 연결되어 있으며, 포트 어드레스는 0x60과 0x64를 사용한다.
실제로 할당된 포트는 두 개지만 포트에서 데이터를 읽을 때와 쓸 때 접근하는 레지스터가 다르므로, 실제로는 네 개의 레지스터와 연결된 것과 같다.
키보드 컨트롤러의 레지스터는 컨트롤 레지스터, 상태 레지스터, 입력 버퍼, 출력 버퍼 네 개가 있으며 크기는 모두 1바이트이다.

## 11.2 키보드 컨트롤러 제어
### 11.2.1 키보드와 키보드 컨트롤러 활성화
일반적으로 부트 로더가 실행되기 전에 키보든느 이미 BIOS에 의해 활성화된 상태이다. 하지만 만약을 대비해서 키보드를 직접 활성화해야한다.
키보드 컨트롤러에 활성화되도록 커맨드 0xAE를 보내고, 키보드에게도 활성화 커맨드를 보내줄 필요가 있다.
키보드로 커맨드를 보내려면 입력 버퍼의 상태 처리와 키보드의 응답 처리를 해야 하므로 약간 까다롭다.

키보드와 키보드 컨트롤러는 프로세서와 비교하면 아주 느리게 동작하므로 프로세서가 커맨드를 전송하고 한참을 기다려야 수행이 완료된다.
여기서 문제는 커맨드가 완료될 때까지 얼마나 기다려야하는 가이다. 커맨드를 처리하는 시간은 키보드와 키보드 컨트롤러의 상태에 따라 가변적인 부분이다.
그러므로 키보드 컨트롤러의 상태를 확인할 수 있는 무엇인가가 필요하다. 이때 사용하는 것이 키보드 컨트롤러의 상태 레지스터(포트 0x64)이다.

### 11.2.2 IA-32e 모드의 호출 규약
1. 파라미터를 전달할 때 레지스터를 우선으로 사용한다.
2. 파라미터 리시트의 왼쪽에서 오른쪽으로 이동하면서 레지스터나 스택을 사용하여삽입한다. 
3. 함수의 반환 값으로 정수타입이면 RAX 또는 RAX와 RDX 레지스터를 사용하고 실수 타입은 XMM0 또는 XMM1 레지스터를 사용한다.

### 11.2.3 키보드 컨트롤러에서 키 값 읽기
### 11.2.4 A20 게이트 활서화와 프로세스 리셋

## 11.3 스캔 코드와 간단한 셸
키보드는 스캔 코드를 전달하기 때문에 아스키 코드로 변환이 필요하다.
### 11.3.1 키보드와 스캔 코드
### 11.3.2 스캔 코드를 ASCII 문자로 변환
### 11.3.3 
## 11.4 키보드 디바이스 드라이버의 통합과 빌드
### 11.4.1 키보드 디바이스드라이버 파일 추가
